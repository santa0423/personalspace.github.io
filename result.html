<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>결과 보기</title>
  <link rel="stylesheet" href="result.css" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
</head>
<body>
  <div class="page">
    <div class="stage" id="stage">
      <div class="frame-box" id="frameBox">
        <!-- 섹션 1 : 초록 박스 (메인 비주얼) -->
        <div class="overlay-box section" id="section-1">
          <!-- 상단: 이름 + 레전드 -->
          <div class="overlay-top-row">
            <!-- 말풍선 이름 박스 -->
            <div class="name-bubble">
              <div class="name-ko">보더</div>
              <div class="name-en">(Border)</div>
            </div>

            <!-- 평균 / 나 레전드 -->
            <div class="legend">
              <div class="legend-item">
                <span class="legend-dot legend-dot-average"></span>
                <span>평균</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot legend-dot-me"></span>
                <span>나</span>
              </div>
            </div>
          </div>

          <!-- 캐릭터 + 타원 영역 -->
          <div class="character-area">
            <div class="ellipse"></div>
            <img src="images/보더.png"
                 alt="보더 캐릭터"
                 class="character-img" />
          </div>

          <!-- 타원 아래 흰색 네모 섹션 2개 -->
          <div class="summary-row">
            <!-- 왼쪽: 점수 카드 -->
            <div class="score-card">
              <div class="score-main">
                <span class="score-number">100</span>
                <span class="score-unit">점</span>
              </div>
              <div class="score-sub">▲ 평균보다 50점 높아요.</div>
              <div class="score-desc">* 점수가 높을수록 팟 침범에 민감한 편이에요.</div>
            </div>

            <!-- 오른쪽: 타입 설명 카드 -->
            <div class="type-card">
              <div class="type-title">거리수호형 팟</div>
              <p class="type-text">
                당신은 넓은 개인 공간이 필요하며, 타인과의 거리가 가까워지면 불편함을 크게 느끼는 편이에요.
                또한, 모든 영역에서 명확한 경계가 필요해요. 터치존, 마인드존, 디지털존 침범 모두에 예민하게 반응해요.
              </p>
            </div>
          </div>
        </div>

        <!-- 섹션 2~6 : 아래 노란/분홍 박스 -->
        <div class="yellow-container">
          <!-- 왼쪽: 노란 3박스 -->
          <div class="left-column">
            <!-- 1번 노란 박스: 터치존 -->
            <div class="yellow-box section" id="section-2">
              <div class="zone-header">각 영역별 나의 팟은?</div>

              <div class="zone-content">
                <!-- 왼쪽 설명 -->
                <div class="zone-left">
                  <div class="zone-title">터치존</div>
                  <div class="zone-bubble">
                    주변에 사람들이나 자극이 많아 처리할 정보량이 넘치면 불편함을 느껴요.
                  </div>
                </div>
              
                <!-- 오른쪽: 4개 요인 바 그래프 -->
                <div class="zone-right">
                  <div class="zone-item" data-touch-key="친분">
                    <span class="zone-label">친분</span>
                    <div class="zone-bars">
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                    </div>
                  </div>
              
                  <div class="zone-item" data-touch-key="정보과잉">
                    <span class="zone-label">정보과잉</span>
                    <div class="zone-bars">
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                    </div>
                  </div>
              
                  <div class="zone-item" data-touch-key="행동제약">
                    <span class="zone-label">행동제약</span>
                    <div class="zone-bars">
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                    </div>
                  </div>
              
                  <div class="zone-item" data-touch-key="통제력">
                    <span class="zone-label">통제력</span>
                    <div class="zone-bars">
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                      <div class="bar"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 2번 노란 박스: 마인드존 -->
            <div class="yellow-box section" id="section-3">
              <div class="zone2-content">
                <!-- 왼쪽: 동그라미 4개 -->
                <div class="zone2-left">
                  <div class="zone2-circle circle-privacy" data-mind-key="사생활">사생활</div>
                  <div class="zone2-circle circle-emotion" data-mind-key="감정개입">감정개입</div>
                  <div class="zone2-circle circle-nonverbal" data-mind-key="비언어">비언어</div>
                  <div class="zone2-circle circle-tone" data-mind-key="어투">어투</div>
                </div>
            
                <!-- 오른쪽: 설명 -->
                <div class="zone2-right">
                  <div class="zone2-title">마인드존</div>
                  <div class="zone2-bubble">
                    시선, 표정, 분위기 등 말하지 않아도 전달되는 압박에
                    불편함을 느껴요.
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 3번 노란 박스: 디지털존 -->
            <div class="yellow-box section" id="section-4">
              <div class="zone3-content">
                <!-- 왼쪽: 설명 -->
                <div class="zone3-left">
                  <div class="zone3-title">디지털존</div>
                  <div class="zone3-bubble">
                    알림, 메시지, 온라인 연결 등에서 오는 디지털 압박에
                    민감하게 반응하는 편이에요.
                  </div>
                </div>

                <!-- 오른쪽: 세로 막대 그래프 -->
                <div class="zone3-right">
                  <div class="zone3-bar-group" data-digital-key="연락">
                    <div class="zone3-vert-bar">
                      <div class="zone3-vert-fill"></div>
                    </div>
                    <div class="zone3-bar-label">연락</div>
                  </div>

                  <div class="zone3-bar-group" data-digital-key="노출">
                    <div class="zone3-vert-bar">
                      <div class="zone3-vert-fill"></div>
                    </div>
                    <div class="zone3-bar-label">노출</div>
                  </div>

                  <div class="zone3-bar-group" data-digital-key="알림">
                    <div class="zone3-vert-bar">
                      <div class="zone3-vert-fill"></div>
                    </div>
                    <div class="zone3-bar-label">알림</div>
                  </div>

                  <div class="zone3-bar-group" data-digital-key="속도">
                    <div class="zone3-vert-bar">
                      <div class="zone3-vert-fill"></div>
                    </div>
                    <div class="zone3-bar-label">속도</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 오른쪽: 분홍 2박스 -->
          <div class="right-column">

            <!-- 분홍 박스 1 : 네모 8개 배치 -->
            <div class="pink-box section" id="section-5">
              <div class="pink-header">침범 후 나의 반응은?</div>

              <div class="pink-box-grid">
                <div class="pink-cell" data-reaction-key="사교성 저하">사교성<br>저하</div>
                <div class="pink-cell" data-reaction-key="생리적 반응">생리적<br>반응</div>
                <div class="pink-cell" data-reaction-key="공격성 증가">공격성<br>증가</div>
                <div class="pink-cell" data-reaction-key="우울">우울</div>
                <div class="pink-cell" data-reaction-key="과업 수행 저하">과업 수행 저하</div>
                <div class="pink-cell" data-reaction-key="이타 행동 감소">이타 행동 감소</div>
                <div class="pink-cell" data-reaction-key="불안">불안</div>
                <div class="pink-cell" data-reaction-key="학습된 무기력">학습된<br>무기력</div>
              </div>
            </div>

            <!-- 분홍 박스 2 : 큰 말풍선 3줄 (상위 3개 반응 설명) -->
            <div class="pink-box section" id="section-6">
              <div class="pink-item">
                <div class="pink-item-label">사교성 저하</div>
                <div class="pink-item-desc">
                  침범 경험으로 대인관계가 부담스러워져 약속을 피하거나, 만나도 깊은 관계 형성을 회피하게 돼요.
                </div>
              </div>
              
              <div class="pink-item">
                <div class="pink-item-label">과업 수행 저하</div>
                <div class="pink-item-desc">
                  침범 경험이 에너지를 소진시켜 업무나 학업에 집중하기 어렵고, 평소보다 능률이 크게 떨어져요.
                </div>
              </div>
              
              <div class="pink-item">
                <div class="pink-item-label">학습된 무기력</div>
                <div class="pink-item-desc">
                  반복된 침범으로 대응의 효과를 느끼지 못해 “어차피 소용없어”라며 경계 세우기 자체를 포기하게 돼요.
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- 배경 이미지 (테스트지 전체 배경) -->
        <div class="frame">
          <img src="images/테스트지 수정.png" alt="테스트 결과" crossorigin="anonymous" />
        </div>

      </div>
    </div>

    <div class="footer">
      <button class="btn" id="actionBtn">인쇄하기</button>
    </div>
  </div>

  <script>
    const W = 560, H = 790, FOOT = 96;
    const frameBox = document.getElementById('frameBox');
    const actionBtn = document.getElementById('actionBtn');

    /* =========================
       0. 공통 유틸
       ========================= */
    function loadAnswers() {
      try {
        const raw = localStorage.getItem('keepod_answers');
        if (!raw) return null;
        const arr = JSON.parse(raw);
        if (!Array.isArray(arr) || arr.length !== 20) return null;
        return arr.map(v => Number(v) || 0);
      } catch (e) {
        console.error('답안 로딩 오류', e);
        return null;
      }
    }

    // 문항 인덱스로 합계 구하는 유틸
    function sumByIndex(answers, indices) {
      return indices.reduce((sum, i) => sum + (answers[i] || 0), 0);
    }

    /* =========================
       1. 질문 → 영역 매핑
       ========================= */
    const QUESTION_ZONE_MAP = {
      touch: {
        "친분":     [4, 6, 19],
        "정보과잉": [5, 12, 16],
        "행동제약": [6, 7, 17],
        "통제력":   [7, 17, 18]
      },
      mind: {
        "사생활":  [8, 2],
        "감정개입":[10, 18],
        "비언어":  [11, 13],
        "어투":    [9, 14]
      },
      digital: {
        "연락": [0, 3, 11],
        "노출": [1, 2],
        "알림": [3, 9],
        "속도": [3, 11]
      }
    };

    /* =========================
       2. 반응 유형 매핑 (8개)
       ========================= */
    const REACTION_QUESTION_MAP = {
      "사교성 저하":   [12, 16, 0],
      "생리적 반응":   [13, 19],
      "공격성 증가":   [14],
      "우울":         [15],
      "과업 수행 저하":[12, 16],
      "이타 행동 감소":[17],
      "불안":         [0, 1, 3, 13, 19],
      "학습된 무기력":[15, 18]
    };

    const REACTION_TEXT = {
      "사교성 저하": "침범 경험으로 대인관계가 부담스러워져 약속을 피하거나, 만나도 깊은 관계 형성을 회피하게 돼요.",
      "생리적 반응": "심장이 두근거리거나 호흡이 가빠지는 등 몸이 먼저 반응하여, 머리로는 괜찮다고 생각해도 쉽게 긴장이 풀리지 않아요.",
      "공격성 증가": "불편함이 쌓이면 짜증이나 분노로 터져 나오기 쉽고, 사소한 자극에도 예민하게 반응하게 돼요.",
      "우울": "에너지가 급격히 떨어지고 의욕이 사라져, 평소에 즐기던 활동도 부담스럽게 느껴질 수 있어요.",
      "과업 수행 저하": "침범 경험이 에너지를 소진시켜 업무나 학업에 집중하기 어렵고, 평소보다 능률이 크게 떨어져요.",
      "이타 행동 감소": "나 스스로도 지치다 보니, 타인을 위해 배려하거나 양보하는 행동이 점점 줄어들 수 있어요.",
      "불안": "언제 또 침범이 일어날지 모른다는 생각에 긴장이 유지되고, 상황을 지나치게 예측하거나 걱정하게 돼요.",
      "학습된 무기력": "반복된 침범으로 대응의 효과를 느끼지 못해 “어차피 소용없어”라며 경계 세우기 자체를 포기하게 돼요."
    };

    /* =========================
       3. 점수 계산
       ========================= */
    function calcZoneScores(answers) {
      const result = {
        touch:   { total: 0, sub: {} },
        mind:    { total: 0, sub: {} },
        digital: { total: 0, sub: {} }
      };

      // 터치, 마인드, 디지털 각각 서브 요인 합계
      for (const [zoneKey, subMap] of Object.entries(QUESTION_ZONE_MAP)) {
        let zoneTotal = 0;
        const subScores = {};
        for (const [subKey, indices] of Object.entries(subMap)) {
          const s = sumByIndex(answers, indices);
          subScores[subKey] = { score: s, max: indices.length * 5 };
          zoneTotal += s;
        }
        result[zoneKey].total = zoneTotal;
        result[zoneKey].sub = subScores;
      }
      return result;
    }

    function calcReactionScores(answers) {
      const arr = [];
      for (const [key, indices] of Object.entries(REACTION_QUESTION_MAP)) {
        const score = sumByIndex(answers, indices);
        const max = indices.length * 5;
        arr.push({ key, label: key, score, max });
      }
      arr.sort((a, b) => b.score - a.score);
      return arr;
    }

    function calcTotalScore(answers) {
      const sum = answers.reduce((s, v) => s + (v || 0), 0);
      const max = answers.length * 5;
      if (!max) return 0;
      return Math.round((sum / max) * 100);
    }

    /* =========================
       4. 패턴/타입 (요약 텍스트용)
       ========================= */
    function findPattern(zoneScores) {
      const entries = [
        { key: 'touch',   score: zoneScores.touch.total },
        { key: 'mind',    score: zoneScores.mind.total },
        { key: 'digital', score: zoneScores.digital.total },
      ];

      const max = Math.max(...entries.map(e => e.score));
      const tops = entries.filter(e => e.score === max).map(e => e.key);

      const priority = ['touch', 'mind', 'digital'];
      const mainZone = priority.find(z => tops.includes(z)) || tops[0];

      const patternKey = [...tops].sort().join('+') || mainZone;

      return { tops, patternKey, mainZone };
    }

    const TYPE_TEXT = {
      "touch": {
        title: "거리수호형 팟",
        desc: "넓은 신체적 거리가 필요하고, 예상치 못한 접촉이나 밀집된 공간에서 특히 예민해지는 타입이에요. 물리적인 거리를 지킬 수 있을 때 가장 편안함을 느껴요."
      },
      "mind": {
        title: "감정방어형 팟",
        desc: "사생활 질문, 감정 강요, 어투와 분위기 같은 보이지 않는 압박에 민감한 타입이에요. 존중받는 대화 방식과 안전한 관계에서 안정감을 느껴요."
      },
      "digital": {
        title: "디지털과부하형 팟",
        desc: "알림, 메시지, 태그 등 디지털 채널을 통한 침범에 민감한 타입이에요. 연락 속도와 노출 범위를 스스로 조절할 수 있을 때 마음이 한결 편안해져요."
      },
      "touch+mind": {
        title: "경계선 예민형 팟",
        desc: "몸의 거리와 마음의 거리 모두에 예민한 타입이에요. 물리적인 간격과 언어·시선·분위기까지 모두 존중받을 때 비로소 안전함을 느껴요."
      },
      "touch+digital": {
        title: "공간·디지털 과부하형 팟",
        desc: "사람이 많은 공간과 끊임없는 디지털 알림 모두에 쉽게 피로해지는 타입이에요. 온·오프라인 모두에서 ‘나만의 여백’을 확보하는 것이 중요해요."
      },
      "mind+digital": {
        title: "관계선 민감형 팟",
        desc: "말투·감정표현과 온라인 소통 방식 모두에서 경계를 중요하게 여기는 타입이에요. 과한 질문이나 빠른 반응을 요구받을 때 부담을 크게 느껴요."
      },
      "touch+mind+digital": {
        title: "풀가드형 팟",
        desc: "터치존, 마인드존, 디지털존 전반에서 침범에 예민한 타입이에요. 하지만 그만큼 자신의 경계를 잘 인식하고 있다는 뜻이기도 해요. 나에게 맞는 보호 전략을 세우는 것이 핵심이에요."
      }
    };

    function updateSummaryCard(totalScore, zoneScores, patternKey) {
      const numEl  = document.querySelector('.score-number');
      const subEl  = document.querySelector('.score-sub');
      const typeEl = document.querySelector('.type-title');
      const descEl = document.querySelector('.type-text');

      if (numEl) numEl.textContent = totalScore.toString();

      const avg = 60;
      const diff = totalScore - avg;
      if (subEl) {
        if (diff > 3) {
          subEl.textContent = `▲ 평균보다 ${Math.abs(diff)}점 높아요.`;
        } else if (diff < -3) {
          subEl.textContent = `▼ 평균보다 ${Math.abs(diff)}점 낮아요.`;
        } else {
          subEl.textContent = `■ 평균과 비슷한 수준이에요.`;
        }
      }

      const typeInfo = TYPE_TEXT[patternKey] || TYPE_TEXT["touch"];
      if (typeEl) typeEl.textContent = typeInfo.title;
      if (descEl) descEl.textContent = typeInfo.desc;
    }

    /* =========================
       4-1. 캐릭터용 단순 존 계산
       (1~4: 디지털, 5~8: 터치, 9~12: 마인드)
       ========================= */
    function decideZoneForCharacter(answers) {
      let digital = 0, touch = 0, mind = 0;
      answers.forEach((v, i) => {
        if (i >= 0 && i <= 3) digital += v;
        else if (i >= 4 && i <= 7) touch += v;
        else if (i >= 8 && i <= 11) mind += v;
      });

      let best = 'touch';
      let bestScore = touch;

      if (mind > bestScore) {
        best = 'mind';
        bestScore = mind;
      }
      if (digital > bestScore) {
        best = 'digital';
        bestScore = digital;
      }
      return best; // 'touch' | 'mind' | 'digital'
    }

    function updateCharacter(zone) {
      const imgEl  = document.querySelector('.character-img');
      const nameKo = document.querySelector('.name-ko');
      const nameEn = document.querySelector('.name-en');
      if (!imgEl || !nameKo || !nameEn) return;

      if (zone === 'touch') {
        imgEl.src = 'images/보더.png';
        imgEl.alt = '보더 캐릭터';
        nameKo.textContent = '보더';
        nameEn.textContent = '(Border)';
      } else if (zone === 'mind') {
        imgEl.src = 'images/리스니.png';
        imgEl.alt = '리스니 캐릭터';
        nameKo.textContent = '리스니';
        nameEn.textContent = '(Lisni)';
      } else if (zone === 'digital') {
        imgEl.src = 'images/네티.png';
        imgEl.alt = '네티 캐릭터';
        nameKo.textContent = '네티';
        nameEn.textContent = '(Neti)';
      }
    }

    /* =========================
       5. 영역별 그래픽 업데이트
       ========================= */
    function updateTouchBars(subScores) {
      const items = document.querySelectorAll('#section-2 .zone-item');
      items.forEach(item => {
        const key = item.getAttribute('data-touch-key');
        const info = subScores[key];
        if (!info) return;
        const ratio = info.max ? info.score / info.max : 0;
        const fillCount = Math.round(ratio * 5);
        const bars = item.querySelectorAll('.bar');
        bars.forEach((bar, idx) => {
          bar.classList.remove('filled', 'empty');
          if (idx < fillCount) bar.classList.add('filled');
          else bar.classList.add('empty');
        });
      });
    }

    function updateMindCircles(subScores) {
      const circles = document.querySelectorAll('#section-3 .zone2-circle');
      let maxScore = 0;
      circles.forEach(c => {
        const key = c.getAttribute('data-mind-key');
        const info = subScores[key];
        if (info && info.score > maxScore) maxScore = info.score;
      });

      circles.forEach(c => {
        const key = c.getAttribute('data-mind-key');
        const info = subScores[key];
        if (!info) return;
        const ratio = maxScore ? info.score / maxScore : 0;
        const brightness = 0.7 + ratio * 0.3;
        c.style.filter = `brightness(${brightness})`;
        c.style.opacity = 0.6 + ratio * 0.4;
      });
    }

    function updateDigitalBars(subScores) {
      const groups = document.querySelectorAll('#section-4 .zone3-bar-group');
      groups.forEach(g => {
        const key = g.getAttribute('data-digital-key');
        const info = subScores[key];
        if (!info) return;
        const ratio = info.max ? info.score / info.max : 0;
        const h = 20 + ratio * 60;
        const fill = g.querySelector('.zone3-vert-fill');
        if (fill) {
          fill.style.height = h + '%';
        }
      });
    }

    /* =========================
       6. 반응 박스 업데이트
       ========================= */
    function highlightReactionGrid(top3) {
      const cells = document.querySelectorAll('.pink-box-grid .pink-cell');
      cells.forEach(c => c.classList.remove('active'));
      top3.forEach(item => {
        const cell = document.querySelector(`.pink-cell[data-reaction-key="${item.key}"]`);
        if (cell) cell.classList.add('active');
      });
    }

    function updateReactionDetails(top3) {
      const items = document.querySelectorAll('#section-6 .pink-item');
      items.forEach((item, idx) => {
        const labelEl = item.querySelector('.pink-item-label');
        const descEl  = item.querySelector('.pink-item-desc');
        const data = top3[idx];
        if (!data) {
          if (labelEl) labelEl.textContent = '-';
          if (descEl)  descEl.textContent  = '해당 반응은 상대적으로 덜 나타나는 편이에요.';
          return;
        }
        if (labelEl) labelEl.textContent = data.label;
        if (descEl)  descEl.textContent  = REACTION_TEXT[data.key] || '';
      });
    }

    /* =========================
       7. 결과 초기화
       ========================= */
    function initResults() {
      const answers = loadAnswers();
      if (!answers) {
        console.warn('답안을 찾을 수 없어 기본 값으로 표시합니다.');
        return;
      }

      const zoneScores     = calcZoneScores(answers);
      const reactionScores = calcReactionScores(answers);
      const totalScore     = calcTotalScore(answers);
      const { patternKey } = findPattern(zoneScores);

      updateSummaryCard(totalScore, zoneScores, patternKey);

      // 캐릭터용 메인 존은 단순 1~12번 합계 기준으로 별도 계산
      const charZone = decideZoneForCharacter(answers);
      updateCharacter(charZone);

      updateTouchBars(zoneScores.touch.sub);
      updateMindCircles(zoneScores.mind.sub);
      updateDigitalBars(zoneScores.digital.sub);

      const top3 = reactionScores.slice(0, 3);
      highlightReactionGrid(top3);
      updateReactionDetails(top3);
    }

    /* =========================
       8. 인쇄/이미지 저장 버튼
       ========================= */
    function isMobile() {
      const vw = (window.visualViewport && window.visualViewport.width) || window.innerWidth;
      const vh = (window.visualViewport && window.visualViewport.height) || window.innerHeight;
      return (vw < 700) || (vh < 900);
    }

    function setAction() {
      if (!isMobile()) {
        actionBtn.textContent = '인쇄하기';
        actionBtn.onclick = () => window.print();
      } else {
        actionBtn.textContent = '이미지로 저장하기';
        actionBtn.onclick = async () => {
          const clone = frameBox.cloneNode(true);
          clone.id = 'capture';
          Object.assign(clone.style, {
            position:'fixed', left:'-9999px', top:'0',
            width:`${W}px`, height:`${H}px`,
            transform:'none'
          });
          document.body.appendChild(clone);

          try {
            const canvas = await html2canvas(clone, {
              backgroundColor: '#ffffff',
              scale: Math.min(3, (window.devicePixelRatio || 2)),
              useCORS: true,
              logging: false
            });
            const link = document.createElement('a');
            link.href = canvas.toDataURL('image/png');
            link.download = `keepod_result_${Date.now()}.png`;
            link.click();
          } catch(e) {
            alert('이미지 저장 중 문제가 발생했습니다. 스크린샷을 이용해주세요.');
            console.error(e);
          } finally {
            clone.remove();
          }
        };
      }
    }

    function scale() {
      const vw = (window.visualViewport && window.visualViewport.width) || window.innerWidth;
      const vh = (window.visualViewport && window.visualViewport.height) || window.innerHeight;
      const usableH = Math.max(100, vh - FOOT);
      const s = Math.min(vw / W, usableH / H);
      // 현재는 transform 스케일 사용 안 함 (원본 크기 유지)
    }

    function init() {
      scale();
      setAction();
      initResults();
    }

    window.addEventListener('resize', () => { scale(); setAction(); });
    window.addEventListener('orientationchange', () => { scale(); setAction(); });
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
